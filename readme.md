# media

media是一个管理本地素材的工具，可以对原始素材进行多维度分类，包括作者、网站、专辑（同义场景：收藏、合集、列表等）、标签。为了避免修改原始素材，目前所有资源都由用户手动录入。

**注意事项：目前增加资源时并没有强制关联作者，因此尽量不要使用增加资源的功能。**

## 简介

### 资源、作者和网站的关系

作为一个分类工具，我们定义了两个基本维度作者和网站。一个资源必须关联一个作者，一个作者必须关联一个网站。资源可以是图片，也可以是视频，也可以是游戏，而作者可以看作网站的用户。目前一个资源只能关联一个作者，一个作者只能关联一个网站，暂不支持一个作者关联多个网站和一个资源关联多个作者。这两种关联方式对应的场景是多平台投稿，但是一个网站可以关联多个作者。未来的版本中会加入大小号功能，加入大小号功能后，可以实现多平台投稿场景。

### 专辑和标签

在网站中，我们通常可以将喜欢的作品或资源收藏下来，不同类型的网站对此操作有不同的描述，在视频网站中是收藏和合集，在音乐软件中是专辑和播放列表，本系统将这些内容都看作专辑。一个专辑是按某个维度分类后的资源合集，一个资源可以根据分类维度不同而关联多个专辑。

标签是另一种常见分类方式。标签是一种无法拆分出子标签的原子细分方式，用来描述资源的某一个特点。为了准确描述一个资源，你需要对一个资源打上多个标签。

## 为什么会开发这么一个工具

作为一个收集达人，我收集的资源包括但不限于网络视频、截图、图片，有些资源可能会因为某些原因被删，比如被举报或者侵权，这时候只有存在本地的资源才是安全的，但本地有没有原始网站的分类方式。我去年就找到了一个优秀的分类工具[billfish](https://www.billfish.cn/)，除此之外，还用过[Adobe bridge](https://www.adobe.com/cn/products/bridge.html)。这两个软件的目标用户是从事设计专业的用户，包括但不限于剪辑、摄影等。

### billfish

在使用 billfish（我目前用过的最新的版本是v2.25.03）的时候，我发现 billfish 不能按作者和专辑进行分类，他只有目录分类和标签分类。我自己的应用场景中，除了必需的标签分类，还需要进行作者分类，因此 billfish 只能满足我一部分的需求，但是不能满足全部需求。此外，由于我的素材以视频为主，且有很多半小时以上的视频，在使用 billfish 导入时，由于 billfish 会解析视频文件，因此导入速度特别慢，且全部素材导入后，billfish 的数据库会变得非常庞大，达到 1GB 以上。

对我来说 billfish 的另一个不好的地方是没有完全的绿色版。经过我测试，如果在本机装安装版，移动盘上装一个绿色版，那么启动时是能识别到移动盘上有一个素材库的，这应该是写了一些内容，按理说本机装的 billfish 是完全感知不到移动硬盘上的素材库的。

### adobe bridge

不用说，很牛逼，但是相对我的需求来说，这个软件太重了。

media 为了解决以上问题，所有数据都放在指定目录下，可以随意迁移，同时各素材库完全无法感知对方的存在。

## 版本管理

- `master`：主分支，当代码稳定后会合并到 `master`。当有新功能发布且稳定后，会在 `master` 打标签作为发布版本。
- `dev-*`：开发分支。主开发分支是 `dev`，如果有更多功能，就加后缀。已定义的固定开发分只有：
- `pre-release`：预发布分支。所有功能代码都会先合并到此分支，稳定后才会合并到 `master` 分支。

总结：`master` 上是稳定代码，`pre-release` 上是稳定代码，但可能还需要一些改动。

## 使用及启动

本仓库是本系统的后台，使用以下技术栈（依赖）：

- springboot
- mybatis（主要用来做条件多的报表查询）。
- spring-data-jpa：用于单表增删改查。
  - hibernate：spring-data-jpa 实现。
- hibernate-validate：验证框架。
- h2database：嵌入式数据库。

### 打包及启动

打包需要 jdk8+。

1. 将[前台](https://github.com/wrote-code/media-ui/)打包出的文件复制到 `src/main/resources/static` 目录下。
2. 进入项目根目录，运行 `mvn -DskipTests=true package`进行打包，也可以直接运行根目录的 `package.bat`。
3. 运行 `java -Dspring.profiles.active=prd -jar jar包名称` 启动系统。

经过以上三步，就可以访问系统了。如果是第一次启动，则需要进入 http://localhot:8080/api/h2，运行 `ddl` 下的 `h2.sql` 初始化数据库，如果不是第一次启动，则只需检查是否有版本好对应的 sql 文件，如果有，则需要备份 `data/*.db` 文件，然后在上面的地址上运行对应的 sql 文件。

项目启动后，会自动在启动目录生成 `data` 目录和 `logs` 目录，前者用来存放 h2 数据文件，后者用来存放日志文件。日志文件只会在本地保留 60 天。

**警告：不要在打包后的 `target` 目录启动项目，如果你这样做了，那么万一哪天你执行了 `mvn package` 命令，就需要从头再来。数据无价，谨慎操作。**

